---
sidebar: sidebar 
permalink: use/failover.html 
keywords: disaster recovery, bluexp disaster recovery, failover, replicate, fail over, vmware, vcenter 
summary: NetApp BlueXPディザスタリカバリは、ディザスタリカバリのワークフローを自動化するクラウドベースのディザスタリカバリサービスです。 
---
= リモートサイトへのアプリケーションのフェイルオーバー
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
災害が発生した場合は、プライマリのオンプレミスVMwareサイトを別のオンプレミスVMwareサイトまたはVMware Cloud on AWSにフェイルオーバーします。フェイルオーバープロセスをテストして、必要なときに正常に実行されることを確認できます。

フェイルオーバー中は、最新のSnapMirror Snapshotコピーが使用されます。または、（SnapMirrorの保持ポリシーに基づいて）ポイントインタイムSnapshotから特定のSnapshotを選択することもできます。ポイントインタイムオプションは、最新のレプリカがすでに侵害または暗号化されているランサムウェアなどの破損イベントに直面している場合に役立ちます。BlueXPのディザスタリカバリでは、使用可能なすべての時点が表示されます。

このプロセスは、業務用サイトが正常かどうか、および重要なインフラ障害以外の理由でディザスタリカバリサイトへのフェイルオーバーを実行しているかどうかによって異なります。

* ソースvCenterまたはONTAPクラスタにアクセスできない本番サイトの重大な障害：BlueXP  ディザスタリカバリでは、リストア元となる使用可能なSnapshotを選択できます。
* 本番環境が正常に稼働している場合：「今すぐスナップショットを作成」するか、以前に作成したスナップショットを選択できます。


この手順では、レプリケーション関係を解除し、vCenterソースVMをオフラインにし、ボリュームをディザスタリカバリvCenterにデータストアとして登録し、プランのフェイルオーバールールを使用して保護対象VMを再起動し、ターゲットサイトで読み取り/書き込みを有効にします。



== フェイルオーバープロセスをテストする

フェイルオーバーを開始する前に、プロセスをテストできます。このテストでは、仮想マシンはオフラインになりません。

フェイルオーバーテストでは、仮想マシンが一時的に作成されます。BlueXPのディザスタリカバリではターゲットボリュームはマッピングされません。代わりに、選択したSnapshotから新しいFlexCloneボリュームが作成され、FlexCloneボリュームのバックアップとなる一時的なデータストアがESXiホストにマッピングされます。

このプロセスでは、オンプレミスのONTAPストレージやAWSのFSx for NetApp ONTAPストレージの物理容量が追加で消費されることはありません。元のソースボリュームは変更されず、ディザスタリカバリ中もレプリカジョブを続行できます。

テストが終了したら、* Clean up test *オプションを使用して仮想マシンをリセットする必要があります。これは推奨されていますが、必須ではありません。

テストフェイルオーバー処理では、本番環境のワークロード、テストサイトで使用されているSnapMirror関係、および正常に動作し続ける必要がある保護対象のワークロードに_not_の影響があります。

.手順
. BlueXPの左側のナビゲーションで、*[保護]*>*[ディザスタリカバリ]*を選択します。
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"] にアクセスし、* Test failover *を選択します。
. [Test failover]ページで、[Test failover]と入力し、*[Test failover *]を選択します。
. テストが完了したら、テスト環境をクリーンアップします。




== フェイルオーバーテスト後のテスト環境のクリーンアップ

フェイルオーバーのテストが完了したら、テスト環境をクリーンアップする必要があります。このプロセスにより、テスト用の場所、FlexClone、および一時データストアから一時VMが削除されます。

.手順
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]  をクリックし、* Clean up failover test *を選択します。
. [Test failover]ページで、「Clean up failover」と入力し、* Clean up failover test *を選択します。




== ソースサイトをディザスタリカバリサイトにフェイルオーバーする

災害が発生した場合は、プライマリオンプレミスVMwareサイトをオンデマンドで別のオンプレミスVMwareサイトにフェイルオーバーするか、FSx for NetApp ONTAPを使用してVMware Cloud on AWSにフェイルオーバーします。

フェイルオーバープロセスでは、次の処理が実行されます。

* 最新のSnapshotを選択した場合は、SnapMirror更新が実行されて最新の変更がレプリケートされます。
* ソース仮想マシンの電源がオフになっている。
* SnapMirror関係が解除され、ターゲットボリュームが読み取り/書き込み可能になります。
* Snapshotの選択に基づいて、アクティブファイルシステムが指定したSnapshot（latestまたはselected）にリストアされます。
* レプリケーション計画でキャプチャされた情報に基づいて、データストアが作成され、VMwareまたはVMCのクラスタまたはホストにマウントされます。
* ターゲット仮想マシンは、[Resource groups]ページで取得した順序に基づいて登録され、電源がオンになります。
* SnapMirror関係がターゲット仮想マシンからソース仮想マシンに反転されます。



TIP: フェイルオーバーが開始されると、リカバリされたVMがディザスタリカバリサイトのvCenter（仮想マシン、ネットワーク、データストア）に表示されます。デフォルトでは、仮想マシンはWorkloadフォルダにリカバリされます。

.手順
. BlueXPの左側のナビゲーションで、*[保護]*>*[ディザスタリカバリ]*を選択します。
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"] をクリックし、*[フェイルオーバー]*を選択します。
+
image:dr-plan-failover3.png["フェイルオーバーページ"]

. [フェイルオーバー]ページで、Snapshotを今すぐ開始するか、リカバリ元のデータストアのSnapshotを選択します。デフォルトは最新です。
+
フェイルオーバーが発生する前に、現在のソースのスナップショットが作成され、現在のデスティネーションにレプリケートされます。

. 通常フェイルオーバーを妨げるエラーが検出された場合でもフェイルオーバーを実行する場合は、* Force failover *を選択します。
. レプリケーション計画のフェイルオーバー後にサービスでリバースSnapMirror保護関係が自動的に作成されないようにするには、*[Skip protection（保護のスキップ）]*を選択します。これは、BlueXP  ディザスタリカバリでリストアしたサイトをオンラインに戻す前に、そのサイトで追加の処理を実行する場合に便利です。
+

TIP: レプリケーションプランの[アクション]メニューから*[リソースの保護]*を選択すると、逆保護を設定できます。これにより、プラン内の各ボリュームに対して逆レプリケーション関係の作成が試行されます。保護が回復するまで、このジョブを繰り返し実行できます。保護が復元されたら、通常の方法でフェイルバックを開始できます。

. ボックスに「failover」と入力します。
. [フェイルオーバー]*を選択します。
. 進捗状況を確認するには、トップメニューで*ジョブ監視*を選択します。

