---
sidebar: sidebar 
permalink: use/failover.html 
keywords: disaster recovery, bluexp disaster recovery, failover, replicate, fail over, vmware, vcenter 
summary: NetApp BlueXPディザスタリカバリは、ディザスタリカバリのワークフローを自動化するクラウドベースのディザスタリカバリサービスです。 
---
= リモートサイトへのアプリケーションのフェイルオーバー
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
災害が発生した場合は、プライマリのオンプレミスVMwareサイトを別のオンプレミスVMwareサイトまたはVMware Cloud on AWSにフェイルオーバーします。

フェイルオーバー中は、最新のSnapMirror Snapshotコピーが使用されます。または、（SnapMirrorの保持ポリシーに基づいて）ポイントインタイムSnapshotコピーから特定のSnapshotコピーを選択することもできます。ポイントインタイムオプションは、最新のレプリカがすでに侵害または暗号化されているランサムウェアなどの破損イベントに直面している場合に役立ちます。BlueXPのディザスタリカバリでは、使用可能なすべての時点が表示されます。

この手順により、レプリケーション関係が解除され、vCenterソースVMがオフラインになり、ターゲットサイトで読み取り/書き込みが可能になります。

フェイルオーバーを開始する前に、プロセスをテストして、必要なときに成功することを確認できます。このテストでは、仮想マシンはオフラインになりません。



== フェイルオーバープロセスをテストする

実際のフェイルオーバーを開始する前に、フェイルオーバープロセスをテストする必要があります。

フェイルオーバーテストでは、仮想マシンが一時的に作成されます。BlueXPのディザスタリカバリではターゲットボリュームはマッピングされません。代わりに、選択したSnapshotから新しいFlexCloneボリュームが作成され、FlexCloneボリュームの作成元の一時的なデータストアがESXiホストにマッピングされます。

このプロセスでは、オンプレミスのONTAPストレージやAWSのFSx for NetApp ONTAPストレージの物理容量が追加で消費されることはありません。元のソースボリュームは変更されず、ディザスタリカバリ中もレプリカジョブを続行できます。

テストが終了したら、* Clean up test *オプションを使用して仮想マシンをリセットする必要があります。これは推奨されていますが、必須ではありません。

.手順
. BlueXPの左側のナビゲーションで、*[保護]*>*[ディザスタリカバリ]*を選択します。
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"] にアクセスし、* Test failover *を選択します。
. [Test failover]ページで、[Test failover]と入力し、*[Test failover *]を選択します。
. テストが完了したら、テスト環境をクリーンアップします。




== フェイルオーバーテスト後のテスト環境のクリーンアップ

フェイルオーバーのテストが完了したら、テスト環境をクリーンアップする必要があります。このプロセスにより、テスト用の場所、FlexClone、および一時データストアから一時VMが削除されます。

.手順
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]  をクリックし、* Clean up failover test *を選択します。
. [Test failover]ページで、「Clean up failover」と入力し、* Clean up failover test *を選択します。




== ソースサイトをディザスタリカバリサイトにフェイルオーバーする

災害が発生した場合は、プライマリオンプレミスVMwareサイトをオンデマンドで別のオンプレミスVMwareサイトにフェイルオーバーするか、FSx for NetApp ONTAPを使用してVMware Cloud on AWSにフェイルオーバーします。

フェイルオーバープロセスでは、次の処理が実行されます。

* 最新のSnapshotを選択した場合は、SnapMirror更新が実行され、最新の変更がレプリケートされます。
* ソース仮想マシンの電源がオフになっている。
* SnapMirror関係が解除され、ターゲットボリュームが読み取り/書き込み可能になります。
* Snapshotの選択に基づいて、指定したSnapshot（LatestまたはSelected）にアクティブファイルシステムがリストアされます。
* レプリケーション計画でキャプチャされた情報に基づいて、データストアが作成され、VMwareまたはVMCのクラスタまたはホストにマウントされます。
* ターゲット仮想マシンは、[Resource groups]ページで取得した順序に基づいて登録され、電源がオンになります。
* SnapMirror関係がターゲット仮想マシンからソース仮想マシンに反転されます。



TIP: フェイルオーバーが開始されると、リカバリされたVMがディザスタリカバリサイトのvCenter（仮想マシン、ネットワーク、データストア）に表示されます。デフォルトでは、仮想マシンはWorkloadフォルダにリカバリされます。

.手順
. BlueXPの左側のナビゲーションで、*[保護]*>*[ディザスタリカバリ]*を選択します。
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
. レプリケーションプランを選択します。
. 右側で、*アクション*オプションを選択します。 image:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"] をクリックし、*[フェイルオーバー]*を選択します。
. [Test failover]ページで、確認するレプリケーション計画の名前を入力し、*[Fail over]*を選択します。
. リカバリ元のデータストアのSnapshotを選択します。  デフォルトは最新です。
. 進捗状況を確認するには、トップメニューで*ジョブ監視*を選択します。

