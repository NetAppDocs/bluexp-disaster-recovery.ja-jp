---
sidebar: sidebar 
permalink: use/drplan-create.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan 
summary: NetApp BlueXPディザスタリカバリは、ディザスタリカバリのワークフローを自動化するクラウドベースのディザスタリカバリサービスです。vCenterサイトを追加したら、ディザスタリカバリまたはレプリケーションの計画を作成できます。 
---
= レプリケーション計画の作成
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
vCenterサイトを追加したら、ディザスタリカバリ（_replication plan_）を作成できます。ソースvCenterとデスティネーションvCenterを選択し、リソースグループを選択して、アプリケーションのリストア方法とパワーオン方法をグループ化します。たとえば、1つのアプリケーションに関連付けられた仮想マシンをグループ化したり、同様の階層を持つアプリケーションをグループ化したりできます。

このような計画は、_ blueprints _と呼ばれることもあります。

レプリケーション計画を作成し、コンプライアンスとテストのスケジュールを編集することもできます。



== 計画の作成

ウィザードでは、次の手順を実行します。

* vCenterサーバを選択
* レプリケートするVMを選択し、グループを割り当てます。
* ソース環境のリソースをデスティネーションにマッピングします。
* 再発の特定
* 計画をレビューする


レプリケーション計画の作成時に、次のいずれかの設定でソースボリュームとターゲットボリューム間のSnapMirror関係を定義できます。

* 1対1
* ファンアウトアーキテクチャで1対多
* コンシステンシグループ内で多対1
* 多対多


.作業を開始する前に
このサービスでSnapMirror関係を作成する場合は、クラスタとそのSVMピアリングがBlueXPディザスタリカバリ以外ですでにセットアップされている必要があります。



=== vCenterサーバを選択

最初にソースvCenterを選択し、次にデスティネーションvCenterを選択します。

.手順
. BlueXPの左側のナビゲーションで、*[保護]*>*[ディザスタリカバリ]*を選択します。
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。または、サービスの使用を開始したばかりの場合は、ダッシュボードで*[レプリケーションプランの追加]*を選択します。
+
image:dr-plan-create-name.png["Add replication plan  gt; Add planページのスクリーンショット"]

. レプリケーションプランの名前を作成します。
. ソースvCenterとターゲットvCenterのリストから、ソースvCenterとターゲットvCenterを選択します。
. 「 * 次へ * 」を選択します。




=== レプリケートするアプリケーションの選択とリソースグループの割り当て

次の手順では、必要な仮想マシンを機能リソースグループにグループ化します。リソースグループを使用すると、依存する仮想マシンのセットを、要件を満たす論理グループにグループ化できます。たとえば、グループには、リカバリ時に実行できる遅延ブート順序が含まれている可能性があります。


TIP: 各リソースグループには、1つ以上の仮想マシンを含めることができます。ここで指定した順序に基づいて、仮想マシンの電源がオンになります。

.手順
. [Applications]ページの左側で、必要に応じてデータストアを検索します。
. [Applications]ページの左側で、複製して選択したグループに割り当てる仮想マシンを選択します。
+
選択した仮想マシンが自動的にグループ1に追加され、新しいグループ2が開始されます。仮想マシンを最後のグループに追加するたびに、別のグループが追加されます。

+
image:dr-plan-create-apps-vms3.png["[Add replication plan  gt; Applications to replicate]ページのスクリーンショット"]

. 必要に応じて、次のいずれかを実行します。
+
** グループを変更するには、グループ*編集*アイコンをクリックします。
** グループから仮想マシンを削除するには、* X *を選択します。
** 仮想マシンを別のグループに移動するには、その仮想マシンを新しいグループにドラッグアンドドロップします。


. 複数のリソースグループがある場合は、グループのシーケンスが発生する操作シーケンスと一致していることを確認してください。
+
グループ内の各仮想マシンは、ここでの順序に基づいて順番に起動されます。2つのグループが並行して開始されます。

. 必要に応じて、*[編集]*アイコンをクリックしてグループの名前を変更します。
. 「 * 次へ * 」を選択します。




=== ソースリソースをターゲットにマッピング

リソースマッピングステップで、ソース環境のリソースをターゲットにマッピングする方法を指定します。

.作業を開始する前に
このサービスでSnapMirror関係を作成する場合は、クラスタとそのSVMピアリングがBlueXPディザスタリカバリ以外ですでにセットアップされている必要があります。

.手順
. [Resource mapping]ページで、フェールオーバー操作とテスト操作の両方に同じマッピングを使用するには、チェックボックスをオンにします。
+
image:dr-plan-resource-mapping.png["レプリケーションプランの[リソースマッピング]タブ"]

. [Failover mappings]タブで、各リソースの右側にある下向き矢印を選択し、それぞれのリソースをマッピングします。
+
** *コンピューティングリソース*
+
*** *ソースとターゲットのデータセンター*
*** *ターゲットホスト*（オプション）
*** *ターゲットクラスタ*（オプション）
*** *ターゲットVMフォルダ*（オプション）：選択したVMを格納する新しいルートフォルダを作成する場合に使用します。


** *仮想ネットワーク*


. [Failover mappings]タブで、各リソースの右側にある下向き矢印を選択します。
+
** *仮想マシン*：適切なセグメントへのネットワークマッピングを選択します。セグメントはすでにプロビジョニングされているので、仮想マシンをマッピングする適切なセグメントを選択してください。
+
このセクションは、選択内容に応じて有効または無効にすることができます。

+
SnapMirrorはボリュームレベルです。そのため、すべての仮想マシンがレプリケーションターゲットにレプリケートされます。データストアに含まれているすべての仮想マシンを選択してください。選択されていない場合は、レプリケーションプランの一部である仮想マシンのみが処理されます。

+
*** * VM CPUおよびRAM *：[仮想マシンの詳細]で、必要に応じてVMのCPUおよびRAMパラメータのサイズを変更できます。
*** *起動順序遅延*:また、リソースグループ全体で選択したすべての仮想マシンの起動順序を変更することもできます。デフォルトでは、リソースグループの選択時に選択された起動順序が使用されますが、この段階で変更を加えることができます。
*** * DHCPまたは静的IP *：レプリケーション計画の仮想マシンセクションでソースとターゲットの場所間のネットワークをマッピングする場合、BlueXPディザスタリカバリにはDHCPと静的IPの2つのオプションがあります。静的IPの場合は、サブネット、ゲートウェイ、およびDNSサーバを設定します。さらに、仮想マシンのクレデンシャルを入力します。
+
**** * DHCP *：このオプションを選択した場合は、VMのクレデンシャルのみを指定します。
**** *静的IP *：ソースVMと同じ情報または異なる情報を選択できます。ソースと同じを選択した場合は、クレデンシャルを入力する必要はありません。一方、ソースと異なる情報を使用する場合は、クレデンシャル、VMのIPアドレス、サブネットマスク、DNS、およびゲートウェイ情報を指定できます。VMゲストOSのクレデンシャルは、グローバルレベルまたは各VMレベルで指定する必要があります。
+
image:dr-plan-create-mapping-vms.png["レプリケーションプランの追加>リソースマッピング>仮想マシンを示すスクリーンショット"]

+
これは、大規模な環境を小規模なターゲットクラスタにリカバリする場合や、1対1の物理VMwareインフラストラクチャをプロビジョニングせずにディザスタリカバリテストを実行する場合に非常に役立ちます。





** *アプリケーションと整合性のあるレプリカ*：アプリケーションと整合性のあるSnapshotコピーを作成するかどうかを指定します。サービスはアプリケーションを休止し、Snapshotを作成してアプリケーションの整合性のある状態を取得します。
** *データストア*：選択した仮想マシンに基づいて、データストアマッピングが自動的に選択されます。
+
このセクションは、選択内容に応じて有効または無効にすることができます。

+
*** * RPO *：リカバリするデータの量（時間で測定）を示す目標復旧時点（RPO）を入力します。たとえば、RPOを60分と入力した場合、常に60分以内のデータがリカバリに含まれている必要があります。災害が発生した場合は、最大60分分のデータが失われます。また、すべてのデータストアに対して保持するSnapshotコピーの数も入力します。
*** * SnapMirror関係*：ボリュームでSnapMirror関係がすでに確立されている場合は、対応するソースとターゲットのデータストアを選択できます。SnapMirror関係のないボリュームを選択した場合は、作業環境とそのピアSVMを選択して作成できます。
+

NOTE: このサービスでSnapMirror関係を作成する場合は、クラスタとそのSVMピアリングがBlueXPディザスタリカバリ以外ですでにセットアップされている必要があります。



** *整合グループ*：レプリケーション計画を作成する際に、異なるボリュームや異なるSVMのVMを含めることができます。BlueXPディザスタリカバリで整合グループSnapshotが作成されます。
+
*** Recovery Point Objective（RPO；目標復旧時点）を指定すると、RPOに基づいてプライマリバックアップがスケジュールされ、セカンダリデスティネーションが更新されます。
*** VMが同じボリュームと同じSVMの場合、サービスは標準のONTAP Snapshotを実行し、セカンダリデスティネーションを更新します。
*** VMが別 々 のボリュームの同じSVMにある場合は、すべてのボリュームを含めることで整合グループSnapshotが作成され、セカンダリデスティネーションが更新されます。
*** VMが別 々 のボリュームと別 々 のSVMにある場合、サービスは同じクラスタまたは別 々 のクラスタ内のすべてのボリュームを含めて、整合グループの開始フェーズとコミットフェーズのSnapshotを実行し、セカンダリデスティネーションを更新します。
*** フェイルオーバー中は任意のSnapshotを選択できます。最新のSnapshotを選択すると、オンデマンドバックアップが作成され、デスティネーションが更新され、そのSnapshotを使用してフェイルオーバーが実行されます。




. テスト環境に異なるマッピングを設定するには、チェックボックスをオフにして*テストマッピング*タブを選択します。前のように各タブを確認しますが、今回はテスト環境について説明します。
+
[Test mappings]タブで、[Virtual Machines]と[Datastores]のマッピングが無効になります。

+

TIP: 後で計画全体をテストできます。ここでは、テスト環境用のマッピングを設定します。





=== 再発の特定

データを別のターゲットに移行する（1回限りの移動）か、SnapMirror頻度でレプリケートするかを選択します。

レプリケートする場合は、データをミラーリングする頻度を特定します。

.手順
. [繰り返し]ページで、*[移行]*または*[レプリケート]*を選択します。
+
** *移行*：アプリケーションをターゲットの場所に移動する場合に選択します。
** *Replicate*:繰り返しのレプリケーションでは'ソース・コピーからの変更を反映して'ターゲット・コピーを最新の状態に維持します


+
image:dr-plan-create-recurrence.png["[Add replication plan  gt; Recurrence]のスクリーンショット"]

. 「 * 次へ * 」を選択します。




=== レプリケーション計画の確認

最後に、レプリケーション計画を確認します。


TIP: レプリケーションプランは、あとで無効にしたり削除したりできます。

.手順
. [Plan Details]、[Failover Mapping]、[VMs]の各タブで情報を確認します。
. [プランの追加]*を選択します。
+
計画が計画のリストに追加されます。





== スケジュールを編集してコンプライアンスをテストし、フェイルオーバーテストが機能することを確認

コンプライアンスおよびフェイルオーバーテストをテストするスケジュールを設定して、必要に応じて正しく動作することを確認できます。

* *コンプライアンス時間への影響*：レプリケーション計画が作成されると、サービスはデフォルトでコンプライアンススケジュールを作成します。デフォルトの準拠時間は30分です。この時間を変更するには、レプリケーションプランのスケジュールの編集を使用します。
* *フェイルオーバーの影響をテスト*：フェイルオーバープロセスをオンデマンドでテストすることも、スケジュールに従ってテストすることもできます。これにより、レプリケーション計画で指定されたデスティネーションへの仮想マシンのフェイルオーバーをテストできます。
+
テストフェイルオーバーでは、FlexCloneボリュームを作成し、データストアをマウントして、そのデータストアのワークロードを移動します。テストフェイルオーバー処理では、本番環境のワークロード、テストサイトで使用されているSnapMirror関係、および正常に動作し続ける必要がある保護対象のワークロードに_not_の影響があります。



スケジュールに基づいてフェイルオーバーテストが実行され、レプリケーション計画で指定されたデスティネーションにワークロードが移動していることが確認されます。

.手順
. BlueXPディザスタリカバリのトップメニューで、*[レプリケーションプラン]*を選択します。
+
image:dr-plan-list.png["レプリケーションプランのリストを示すスクリーンショット"]

. [アクション]*を選択します。 image:icon-horizontal-dots.png["水平ドット[アクション]メニュー"] アイコンをクリックし、*[スケジュールの編集]*を選択します。
. BlueXPディザスタリカバリでテストへの準拠をチェックする頻度を分単位で入力します。
. フェイルオーバーテストに問題がないことを確認するには、*[毎月のスケジュールでフェイルオーバーを実行する]*をオンにします。
+
.. テストを実行する日にちと時刻を選択します。
.. テストを開始する日付をyyyy-mm-dd形式で入力します。
+
image:dr-plan-schedule-edit.png["スケジュールを編集できる場所を示すスクリーンショット"]



. フェイルオーバーテスト終了後にテスト環境をクリーンアップするには、*[Automatically clean up after test failover]*をオンにします。
+

NOTE: このプロセスでは、テスト用の場所から一時VMの登録が解除され、作成されたFlexCloneボリュームが削除され、一時データストアがアンマウントされます。

. [ 保存（ Save ） ] を選択します。

