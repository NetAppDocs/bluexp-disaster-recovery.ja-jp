---
sidebar: sidebar 
permalink: reference/evs-deploy-guide-rp-operations.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, netapp, ontap 
summary: Amazon EVS と Amazon FSx for NetApp ONTAP を使用した BlueXP 災害復旧の紹介。AmazonEVS と Amazon FSx for NetApp ONTAP で BlueXP 災害復旧を使用して、フェイルオーバーの実行、フェイルオーバーのテスト、リソースの更新、移行、スナップショットの即時作成、レプリケーションプランの無効化または有効化、古いスナップショットのクリーンアップ、スナップショットの調整、レプリケーションプランの削除、スケジュールの編集を行うことができます。 
---
= BlueXP 災害復旧でレプリケーション プラン操作を実行する
:allow-uri-read: 


[role="lead"]
Amazon EVS および Amazon FSx for NetApp ONTAP と BlueXP 災害復旧を併用して、フェイルオーバー、フェイルオーバーのテスト、リソースの更新、移行、今すぐスナップショットを作成する、レプリケーション プランの無効化/有効化、古いスナップショットのクリーンアップ、スナップショットの調整、レプリケーション プランの削除、スケジュールの編集などの操作を実行します。



== フェイルオーバー

実行する必要がある主な操作は、決して起こらないことを願う操作、つまり、オンプレミスの運用サイトで壊滅的な障害が発生した場合に DR (宛先) データセンターにフェールオーバーすることです。

フェイルオーバーは手動で開始されるプロセスです。

.フェイルオーバー操作にアクセスする手順
. BlueXP の左側のナビゲーションから、*保護* > *災害復旧* を選択します。
. BlueXP 災害復旧メニューから、「レプリケーション プラン」を選択します。


.フェイルオーバーを実行する手順
. レプリケーションプランページで、レプリケーションプランのアクションオプションを選択します。 image:icon-horizontal-dots.png["アクションメニューの水平ドット"] 。
. [フェイルオーバー]*を選択します。
+
image:evs-rp-menu-failover.png["フェイルオーバーメニューオプション"]

. 本番サイト（保護対象サイト）にアクセスできない場合は、以前に作成したスナップショットをリカバリイメージとして選択してください。これを行うには、「*選択*」を選択してください。
. リカバリに使用するバックアップを選択します。
. （オプション）BlueXPディザスタリカバリで、レプリケーションプランの状態に関係なくフェイルオーバープロセスを強制的に実行するかどうかを選択します。これは最後の手段としてのみ実行してください。
. (オプション) 実稼働サイトが復旧された後、BlueXP 災害復旧によって逆保護関係が自動的に作成されるかどうかを選択します。
. 続行することを確認するには、「Failover」という単語を入力します。
. *フェイルオーバー*を選択します。
+
image:evs-rp-failover-dialog.png["フェイルオーバーダイアログボックス"]





== テストフェイルオーバー

テスト フェイルオーバーは、2 つの違いを除いてフェイルオーバーと似ています。

* 実稼働サイトは引き続きアクティブであり、すべての VM は引き続き期待どおりに動作しています。
* 運用 VM の BlueXP 災害復旧保護は継続されます。


これは、デスティネーションサイトでネイティブのONTAP FlexCloneボリュームを使用することで実現されます。テストフェイルオーバーの詳細については、以下を参照してください。 link:../use/failover.html["リモートサイトへのアプリケーションのフェイルオーバー | NetApp ドキュメント"] 。

テスト フェイルオーバーを実行する手順は、レプリケーション プランのコンテキスト メニューの [テスト フェイルオーバー] 操作を使用することを除いて、実際のフェイルオーバーを実行する手順と同じです。

.手順
. レプリケーションプランのアクションオプションを選択しますimage:icon-horizontal-dots.png["アクションメニューの水平ドット"] 。
. メニューから*フェイルオーバーのテスト*を選択します。
+
image:evs-rp-menu-test-failover.png["テストフェイルオーバーメニューオプション"]

. 本番環境の最新の状態を取得するか（今すぐスナップショットを取得する）、以前に作成したレプリケーション プランのバックアップを使用するか（選択）を決定します。
. 以前に作成したバックアップを選択した場合は、リカバリに使用するバックアップを選択します。
. 続行するかどうかを確認するには、「Test failwold」という単語を入力します。
. [Test failover]*を選択します。
+
image:evs-test-failover-dialog.png["テストフェイルオーバーダイアログボックス"]





== コンプライアンスチェックを実行する

コンプライアンスチェックは、デフォルトでは3時間ごとに実行されます。必要に応じて、手動でコンプライアンスチェックを実行することもできます。

.手順
. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. レプリケーション プランの [アクション] メニューから [コンプライアンス チェックを実行] オプションを選択します。
+
image:evs-rp-menu-compliance-check.png["コンプライアンスチェックの実行メニューオプション"]

. BlueXP 災害復旧がコンプライアンス チェックを自動的に実行する頻度を変更するには、レプリケーション プランの [アクション] メニューから [スケジュールの編集] オプションを選択します。




== リソースを更新する

仮想インフラストラクチャに変更を加えた場合（VMの追加または削除、データストアの追加または削除、VMのデータストア間の移動など）、BlueXPディザスタリカバリサービスで影響を受けるvCenterクラスタを更新する必要があります。このサービスはデフォルトで24時間ごとに自動的に更新を実行しますが、手動で更新することで、最新の仮想インフラストラクチャ情報が利用でき、ディザスタリカバリ保護に反映されます。

更新が必要となるケースは 2 つあります。

* vCenter の更新: vCenter クラスタに VM が追加、削除、または移動されるたびに、vCenter の更新を実行します。
* レプリケーション プランの更新: 同じソース vCenter クラスタ内のデータストア間で VM が移動されるたびに、レプリケーション プランの更新を実行します。


image::evs-rp-menu-refresh-resources.png[リソースメニューオプションの更新]



== 移行

BlueXP のディザスタリカバリは主にディザスタリカバリのユースケースで使用されますが、VM セットをソースサイトからターゲットサイトへ一括移動することも可能です。これは、クラウドへの協調的な移行プロジェクトに活用できるだけでなく、悪天候、政情不安、その他の一時的な壊滅的な事象の発生といった災害の回避にも活用できます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. レプリケーション プラン内の VM を宛先の Amazon EVS クラスターに移動するには、レプリケーション プランの [アクション] メニューから [*移行*] を選択します。
+
image::evs-rp-menu-migrate.png[移行メニューオプション]

. [移行] ダイアログ ボックスに情報を入力します。




== 今すぐスナップショットを撮る

いつでも、レプリケーションプランのスナップショットを即時に取得できます。このスナップショットは、レプリケーションプランのスナップショット保持数によって設定されたBlueXPの災害復旧に関する考慮事項に含まれます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. レプリケーション プランのリソースのスナップショットをすぐに取得するには、レプリケーション プランの [アクション] メニューで [今すぐスナップショットを取得] を選択します。
+
image::evs-rp-menu-take-snapshot-now.png[今すぐスナップショットを撮るメニューオプション]





== レプリケーションプランを無効または有効にする

レプリケーションプロセスに影響を与える可能性のある操作やメンテナンスを実行するために、レプリケーションプランを一時的に停止する必要がある場合があります。このサービスでは、レプリケーションを停止および開始する方法を提供しています。

. レプリケーションを一時的に停止するには、レプリケーション プランの [アクション] メニューで [無効] を選択します。
. レプリケーションを再開するには、レプリケーション プランの [アクション] メニューで [*有効*] を選択します。
+
レプリケーションプランがアクティブな場合、「*有効*」コマンドはグレー表示されます。レプリケーションプランが無効な場合、「*無効*」コマンドはグレー表示されます。

+
image::evs-rp-menu-disable-enable.png[無効化/有効化メニューオプション]





== 古いSnapshotをクリーンアップ

ソースサイトとターゲットサイトに保持されている古いスナップショットをクリーンアップする必要がある場合があります。これは、レプリケーションプランのスナップショット保持数が変更された場合に発生する可能性があります。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. これらの古いスナップショットを手動で削除するには、レプリケーション プランの [アクション] メニューから [古いスナップショットをクリーンアップ] を選択します。
+
image::evs-rp-menu-cleanup-old-snapshots.png[古いスナップショットをクリーンアップするメニューオプション]





== スナップショットの調整

このサービスはONTAPボリュームのスナップショットをオーケストレーションするため、ONTAPストレージ管理者は、サービスに認識されることなく、ONTAP System Manager、ONTAP CLI、またはONTAP REST APIを使用してスナップショットを直接削除できます。このサービスは、ソースクラスタ上のスナップショットのうち、デスティネーションクラスタ上に存在しないスナップショットを24時間ごとに自動的に削除します。ただし、これはオンデマンドで実行できます。この機能を使用すると、すべてのサイトでSnapshotの整合性を確保できます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. 宛先クラスターに存在しないスナップショットをソース クラスターから削除するには、レプリケーション プランの [アクション] メニューから [*スナップショットの調整*] を選択します。
+
image::evs-rp-menu-reconcile-snapshots.png[スナップショットの調整メニューオプション]





== レプリケーションプランを削除する

レプリケーション プランが不要になった場合は、削除できます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. レプリケーション プランを削除するには、レプリケーション プランのコンテキスト メニューから [削除] を選択します。
+
image::evs-rp-menu-delete.png[削除メニューオプション]





== スケジュールを編集します

テストフェイルオーバーとコンプライアンス チェックの 2 つの操作が定期的に自動的に実行されます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. これら 2 つの操作のいずれかのスケジュールを変更するには、レプリケーション プランの [スケジュールの編集] を選択します。
+
image::evs-rp-menu-edit-schedules.png[スケジュール編集メニューオプション]





=== コンプライアンスチェック間隔を変更する

デフォルトでは、コンプライアンスチェックは3時間ごとに実行されます。この間隔は30分から24時間までの間で変更できます。

この間隔を変更するには、[スケジュールの編集] ダイアログ ボックスの [頻度] フィールドを変更します。

image::evs-rp-edit-compliance-check-schedule.png[コンプライアンスチェックスケジュール]



=== 自動テストフェイルオーバーをスケジュールする

テストフェイルオーバーはデフォルトで手動で実行されます。自動テストフェイルオーバーをスケジュール設定することで、レプリケーションプランが期待どおりに実行されることを確認できます。テストフェイルオーバーのプロセスの詳細については、以下をご覧ください。 link:../use/failover.html["フェイルオーバープロセスをテストする"] 。

.テストフェイルオーバーをスケジュールする手順
. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["BlueXPディザスタリカバリサービスの[Actions]メニューアイコン"]レプリケーション プランの横にあります。
. *フェイルオーバーを実行*を選択します。
. *スケジュールに従ってテストフェイルオーバーを実行する*チェックボックスをオンにします。
. (オプション) *スケジュールされたテスト フェールオーバーにオンデマンド スナップショットを使用する* をオンにします。
. 「繰り返し」ドロップダウンで間隔の種類を選択します。
. テストフェイルオーバーを実行するタイミングを選択する
+
.. 毎週: 曜日を選択
.. 月次: 月の日付を選択


. テストフェイルオーバーを実行する時刻を選択します
. 開始日を選択してください。
. サービスでテスト環境を自動的にクリーンアップするかどうか、またクリーンアップ プロセスを開始する前にテスト環境をどのくらいの時間実行するかを決定します。
. [ 保存（ Save ） ] を選択します。
+
image::evs-rp-edit-schedule-test-failover.png[スケジュールテストフェイルオーバーの編集]


